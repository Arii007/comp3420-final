<!--
  COMP 3420 – Final Programming Exam

  This page sets up the WebGL canvas and links the shaders and JavaScript
  needed to reproduce my chosen reference image (a gold sphere sitting on
  a grey cube on a wooden floor). The vertex and fragment shaders implement
  Phong lighting with optional texturing. The wood-floor.jpg image is loaded
  via an <img> tag and used as the texture for the floor. Keyboard controls
  (A/D, W/S, R) are used to rotate the object stack and move the camera.
-->

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>COMP 3420 – Final Programming Exam</title>

  

    <!-- Vertex shader -->
    <script id="phong-V" type="x-shader/x-vertex">
        #version 300 es
        precision mediump float;

        in vec3 aVertexPosition;
        in vec3 aVertexNormal;
        in vec2 aTexCoord;

        uniform mat4 uModelMatrix;
        uniform mat4 uViewMatrix;
        uniform mat4 uProjectionMatrix;

        out vec3 vFragPos;
        out vec3 vNormal;
        out vec2 vTexCoord;

        void main() {
            vec4 worldPos = uModelMatrix * vec4(aVertexPosition, 1.0);
            vFragPos  = worldPos.xyz;
            vNormal   = mat3(uModelMatrix) * aVertexNormal;
            vTexCoord = aTexCoord;

            gl_Position = uProjectionMatrix * uViewMatrix * worldPos;
        }
    </script>

    <!-- Fragment shader -->
    <script id="phong-F" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec3 vFragPos;
        in vec3 vNormal;
        in vec2 vTexCoord;

        uniform vec3 uViewPosition;

        uniform vec3 uMaterialAmbient;
        uniform vec3 uMaterialDiffuse;
        uniform vec3 uMaterialSpecular;
        uniform float uShininess;

        uniform vec3 uLightPosition;
        uniform vec3 uLightAmbient;
        uniform vec3 uLightDiffuse;
        uniform vec3 uLightSpecular;

        uniform bool  uUseTexture;
        uniform sampler2D uSampler;

        out vec4 fragColor;

        void main() {

            vec3 norm       = normalize(vNormal);
            vec3 lightDir   = normalize(uLightPosition - vFragPos);
            vec3 viewDir    = normalize(uViewPosition - vFragPos);
            vec3 reflectDir = reflect(-lightDir, norm);

            // base color from material or texture
            vec3 baseColor = uMaterialDiffuse;
            if (uUseTexture) {
                baseColor = texture(uSampler, vTexCoord).rgb;
            }

            // Ambient
            vec3 ambient  = uLightAmbient * uMaterialAmbient * baseColor;

            // Diffuse (Lambert)
            float diff    = max(dot(norm, lightDir), 0.0);
            vec3 diffuse  = uLightDiffuse * diff * baseColor;

            // Specular (Phong)
            float spec    = pow(max(dot(viewDir, reflectDir), 0.0), uShininess);
            vec3 specular = uLightSpecular * spec * uMaterialSpecular;

            vec3 color = ambient + diffuse + specular;
            fragColor  = vec4(color, 1.0);
        }
    </script>

    <!-- ===== JS libs and main script ===== -->
    <script src="gl-matrix-min.js"></script>
    <script src="cgIShape.js"></script>
    <script src="myShapes-min.js"></script>
    <script src="finalMain.js"></script>

    <!-- Wood texture image for the floor -->
    <img id="wood-texture" src="wood-floor.jpg" style="display:none;">
</head>

<body>
    <h1>COMP 3420 – Final Programming Exam</h1>

    <table>
        <tr>
            <td>
                <canvas id="webgl-canvas" width="600" height="400">
                    Your browser does not support the HTML5 canvas element.
                </canvas>
            </td>
            <td>
                <h3>Controls</h3>
                <table border="1">
                    <tbody>
                        <tr>
                            <td>A / D or ← / →</td>
                            <td>Rotate the stack of objects left / right</td>
                        </tr>
                        <tr>
                            <td>W / S or ↑ / ↓</td>
                            <td>Move camera closer / farther</td>
                        </tr>
                        <tr>
                            <td>R</td>
                            <td>Reset camera and rotation</td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    </table>
</body>
</html>
